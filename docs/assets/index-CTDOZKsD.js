(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const de="cupboard-app-state-v1",Ne="/api/cupboard-state",Ge=450,Ae=7e3,Me=[{name:"Arribato rice",quantity:"1.25",category:"Grains & Pasta"},{name:"Microwave rice",quantity:"2",category:"Grains & Pasta"},{name:"Couscous",quantity:"2",category:"Grains & Pasta"},{name:"Penne Pasta",quantity:"1",category:"Grains & Pasta"},{name:"Rigatoni",quantity:"0.5",category:"Other"},{name:"Medium egg noodles",quantity:"0.5",category:"Grains & Pasta"},{name:"Risotto truffle kit",quantity:"1",category:"Grains & Pasta"},{name:"Miso paste",quantity:"1",category:"Spices & Seasonings"},{name:"Capsicana hot honey",quantity:"1",category:"Sauces & Condiments"},{name:"Garlic seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"BBQ seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"Lentil vertes",quantity:"1",category:"Legumes & Flours"},{name:"Red lentils",quantity:"1",category:"Legumes & Flours"},{name:"Gram flour",quantity:"1",category:"Legumes & Flours"},{name:"Hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Sweet hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Texas BBQ sauce",quantity:"1.25",category:"Sauces & Condiments"},{name:"Korean hot sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Caramel sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Kewpie",quantity:"1",category:"Sauces & Condiments"},{name:"Peanut butter",quantity:"2",category:"Canned Goods"},{name:"Chilli paste",quantity:"1",category:"Sauces & Condiments"},{name:"Mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Grainy mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Chicken korma paste",quantity:"1",category:"Sauces & Condiments"},{name:"Cuppa soup chicken",quantity:"2",category:"Canned Goods"},{name:"Bread crumbs",quantity:"1",category:"Canned Goods"},{name:"Chickpeas",quantity:"1",category:"Legumes & Flours"},{name:"Red cabbage jar",quantity:"1",category:"Canned Goods"},{name:"Gherkins",quantity:"1",category:"Canned Goods"},{name:"Black beans",quantity:"4",category:"Canned Goods"},{name:"Chopped tomatoes",quantity:"1",category:"Canned Goods"},{name:"Coconut cream",quantity:"2",category:"Canned Goods"},{name:"Peach slices",quantity:"1",category:"Canned Goods"},{name:"Tuna tin",quantity:"1",category:"Canned Goods"},{name:"Baked beans",quantity:"1",category:"Canned Goods"},{name:"Chicken gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Vegan gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Chicken stock",quantity:"1",category:"Stock & Gravy"},{name:"Vegetable stock",quantity:"1",category:"Stock & Gravy"},{name:"Beef stock",quantity:"1",category:"Stock & Gravy"}],me="1",ye="0",C=["Canned Goods","Grains & Pasta","Legumes & Flours","Sauces & Condiments","Spices & Seasonings","Stock & Gravy","Other"],p=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),ae=document.querySelector("#filter-bar"),re=document.querySelector("#search-panel"),z=document.querySelector("#search-toggle-btn"),Pe=document.querySelector("#clear-search-btn"),R=document.querySelector("#items-body"),Oe=document.querySelector("#row-template"),Be=document.querySelector("#add-section"),ge=document.querySelector("#new-item-form"),se=document.querySelector("#form-message"),fe=document.querySelector("#new-name"),xe=document.querySelector("#new-quantity"),J=document.querySelector("#new-low-level"),b=document.querySelector("#new-category-select"),Fe=document.querySelector("#new-custom-category-wrap"),H=document.querySelector("#new-custom-category"),y=document.querySelector("#edit-dialog"),Ue=document.querySelector("#edit-item-form"),pe=document.querySelector("#edit-name"),Se=document.querySelector("#edit-low-level"),E=document.querySelector("#edit-category-select"),De=document.querySelector("#edit-custom-category-wrap"),B=document.querySelector("#edit-custom-category"),Re=document.querySelector("#delete-item-button"),$e=document.querySelector("#cancel-edit"),ce=document.querySelector("#edit-message"),Ce=document.querySelector("#undo-toast"),Qe=document.querySelector("#undo-toast-message"),ze=document.querySelector("#undo-delete-button"),h=document.querySelector("#search-input"),Je=document.querySelector("#top-add-button"),$=document.querySelector("#cloud-status-badge"),ve=document.querySelector("#cloud-sync-now-button");let c=We(),v=null,I="",T=!1,g="all",x=null,P=null,_=null,L=!1,Q=!1,G="",N=null,qe="",q=!1;function j(){return globalThis.crypto?.randomUUID?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function w(e){if(e==null)return null;const t=String(e).trim().replace(",",".");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function ie(e){return Number(e.toFixed(3)).toString()}function ue(e){return String(e??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function we(e){const t=w(e.quantity),n=w(e.lowLevel);return t===null||n===null?!1:t<=n}function Y(){return Me.map(e=>({id:j(),name:e.name,quantity:e.quantity,lowLevel:me,category:e.category}))}function He(e){const t=new Set(C);for(const n of e)t.add(n.category);return[...t].sort((n,a)=>n.localeCompare(a))}function X(e,t){const n=Array.isArray(e?.items)?e.items.filter(o=>o&&o.name&&o.category).map(o=>({id:o.id||j(),name:String(o.name).trim(),quantity:String(o.quantity??""),lowLevel:String(o.lowLevel??me),category:String(o.category).trim()})):t,a=Array.isArray(e?.customCategories)?e.customCategories.map(o=>String(o).trim()).filter(Boolean):[];return{items:n,customCategories:a}}function W(e){const t=e.items.map(a=>({id:String(a.id),name:String(a.name),quantity:String(a.quantity),lowLevel:String(a.lowLevel),category:String(a.category)})).sort((a,o)=>{const s=p.compare(a.id,o.id);if(s!==0)return s;const r=p.compare(a.name,o.name);return r!==0?r:p.compare(a.category,o.category)}),n=[...e.customCategories].sort((a,o)=>p.compare(a,o));return JSON.stringify({items:t,customCategories:n})}function We(){const e=Y(),t=He(e);try{const n=localStorage.getItem(de);if(!n)return{items:e,customCategories:t.filter(o=>!C.includes(o))};const a=JSON.parse(n);return X(a,e)}catch{return{items:e,customCategories:t.filter(n=>!C.includes(n))}}}function he(){localStorage.setItem(de,JSON.stringify(c))}function S(){he(),Ie()}function Le(){const e=new Set([...C,...c.customCategories]);for(const t of c.items)e.add(t.category);return[...e].sort((t,n)=>t.localeCompare(n))}function Ke(){const e=ue(I).split(/\s+/).filter(Boolean);return c.items.filter(t=>{const n=g==="all"||g==="low"&&we(t)||t.category===g;if(e.length===0)return n;const a=ue(`${t.name} ${t.category}`);return e.every(o=>a.includes(o))})}function Ve(){const e=new Map;for(const n of Ke()){const a=n.category;e.has(a)||e.set(a,[]),e.get(a).push(n)}return[...e.keys()].sort((n,a)=>p.compare(n,a)).map(n=>{const a=e.get(n).slice().sort((o,s)=>{const r=p.compare(o.name.trim(),s.name.trim());return r!==0?r:p.compare(o.id,s.id)});return{category:n,items:a}})}function le(e,t){const n=Le();e.innerHTML="";for(const o of n){const s=document.createElement("option");s.value=o,s.textContent=o,e.append(s)}const a=document.createElement("option");a.value="__custom__",a.textContent="+ Create new category",e.append(a),t&&[...e.options].some(o=>o.value===t)&&(e.value=t)}function be(){le(b,b.value),le(E,E.value)}function je(){const e=[{value:"all",label:"All"},{value:"low",label:"Low"},...Le().map(t=>({value:t,label:t}))];e.some(t=>t.value===g)||(g="all"),ae.innerHTML="";for(const t of e){const n=document.createElement("button");n.type="button",n.className=`filter-chip${g===t.value?" active":""}`,n.setAttribute("role","radio"),n.setAttribute("aria-checked",g===t.value?"true":"false"),n.dataset.filter=t.value;const a=document.createElement("span");a.textContent=t.label,n.append(a),n.addEventListener("click",()=>{g=t.value,d()}),ae.append(n)}}function Z(){const e=Ve();if(R.innerHTML="",e.length===0){const t=document.createElement("p");t.className="empty-state",t.textContent=I?"No items match your search.":"No items yet. Add your first cupboard item below.",R.append(t);return}for(const t of e){const n=document.createElement("section");n.className="category-section";const a=document.createElement("div");a.className="category-header";const o=document.createElement("span");o.textContent=t.category,a.append(o);const s=document.createElement("div");s.className="items-list",s.setAttribute("role","list");for(const r of t.items){const u=Oe.content.firstElementChild.cloneNode(!0),i=u.querySelector('[data-field="name"]'),f=u.querySelector('[data-field="quantity"]'),ke=u.querySelector('[data-action="decrease"]'),Te=u.querySelector('[data-action="increase"]'),_e=u.querySelector('[data-action="edit"]');i.textContent=r.name,f.value=r.quantity,u.classList.toggle("low",we(r)),f.addEventListener("change",()=>{r.quantity=f.value.trim(),S(),d()}),ke.addEventListener("click",()=>{const oe=w(r.quantity)??0,D=Math.max(0,oe-1);r.quantity=ie(D),S(),d()}),Te.addEventListener("click",()=>{const D=(w(r.quantity)??0)+1;r.quantity=ie(D),S(),d()}),_e.addEventListener("click",()=>{at(r.id)}),s.append(u)}n.append(a,s),R.append(n)}}function l(e,t="ok"){se.textContent=e,se.dataset.tone=t}function m(e,t){$.classList.remove("syncing","synced","error"),e&&$.classList.add(e),$.textContent=t}function F(){ve.disabled=L,L?m("syncing","Syncing..."):q?m("synced","Shared cloud"):G?m("error","Cloud error"):m("","Local only")}function Ye(){_!==null&&(window.clearTimeout(_),_=null)}function Xe(){N!==null&&(window.clearInterval(N),N=null)}async function Ee(e,t){const n={method:e,headers:{"content-type":"application/json"}};t!==void 0&&(n.body=JSON.stringify(t));let a;try{a=await fetch(Ne,n)}catch{throw new Error("Could not reach cloud API.")}let o=null;try{o=await a.json()}catch{o=null}if(!a.ok){const s=o?.error||`Cloud API error (${a.status}).`;throw new Error(s)}return o??{}}async function ee(){if(L){Q=!0;return}L=!0,F();try{const e=JSON.parse(JSON.stringify(c)),n=(await Ee("PUT",{data:e}))?.data??e,a=Y(),o=X(n,a);qe=W(o),q=!0,G="",m("synced","Shared cloud")}catch(e){q=!1,G=e instanceof Error?e.message:"Unknown cloud sync error",m("error","Cloud error")}finally{L=!1,F(),Q&&(Q=!1,Ie())}}function Ie(){Ye(),_=window.setTimeout(()=>{_=null,ee()},Ge)}async function K(e={}){const t=!!e.seedIfMissing;L||m("syncing","Syncing...");try{const a=(await Ee("GET"))?.data??null;if(q=!0,!a){t&&await ee();return}const o=Y(),s=X(a,o),r=W(s),u=W(c);qe=r,G="",r!==u&&(c=s,he(),d(),l("Updated from shared cloud.","ok")),m("synced","Shared cloud")}catch(n){q=!1,G=n instanceof Error?n.message:"Unknown error",m("error","Cloud error")}finally{F()}}function Ze(){N===null&&(N=window.setInterval(()=>{K()},Ae))}async function et(){F(),await K({seedIfMissing:!0}),q&&Ze(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&K()}),window.addEventListener("beforeunload",Xe),l(q?"Ready. Shared cloud sync enabled.":"Ready. Local-only mode.","ok")}function tt(){P!==null&&(window.clearTimeout(P),P=null)}function V(e=!0){tt(),Ce.classList.remove("open"),e&&(x=null)}function nt(e,t){V(!1),x={item:e,index:t},Qe.textContent=`Removed ${e.name}.`,Ce.classList.add("open"),P=window.setTimeout(()=>{V(!0)},3e3)}function ot(){if(!x)return;const{item:e,index:t}=x,n=Math.max(0,Math.min(t,c.items.length));c.items.splice(n,0,e),!C.includes(e.category)&&!c.customCategories.includes(e.category)&&(c.customCategories.push(e.category),c.customCategories.sort((a,o)=>a.localeCompare(o))),S(),V(!0),d(),l(`Restored ${e.name}.`,"ok")}function U(){const e=I.trim().length>0;re.classList.toggle("open",T),re.classList.toggle("has-query",e),z.classList.toggle("active",T||e),z.setAttribute("aria-expanded",T?"true":"false")}function A(e,t={}){T=e,U(),e&&t.focus&&window.setTimeout(()=>{h.focus()},120)}function M(){I="",h.value="",Z(),U()}function te(){const e=b.value==="__custom__";Fe.classList.toggle("hidden",!e),H.required=e,e&&H.focus()}function O(e,t="ok"){ce.textContent=e,ce.dataset.tone=t}function ne(){const e=E.value==="__custom__";De.classList.toggle("hidden",!e),B.required=e,e||(B.value="")}function at(e){const t=c.items.find(n=>n.id===e);t&&(v=e,be(),pe.value=t.name,Se.value=t.lowLevel,E.value=t.category,B.value="",ne(),O("Update details and save."),typeof y.showModal=="function"?y.showModal():y.setAttribute("open",""))}function k(){v=null,typeof y.close=="function"?y.close():y.removeAttribute("open")}function rt(e){if(e.preventDefault(),!v)return;const t=c.items.find(i=>i.id===v);if(!t){k();return}const n=pe.value.trim(),a=Se.value.trim(),o=E.value,s=B.value.trim(),r=o==="__custom__"?s:o;if(!n||!a||!r){O("Please complete all fields.","error");return}if(w(a)===null){O("Running low level must be a number.","error");return}if(c.items.some(i=>i.id!==t.id&&i.name.toLowerCase()===n.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){O("That item already exists in this category.","error");return}t.name=n,t.lowLevel=a,t.category=r,!C.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),S(),k(),d(),l(`Updated ${n}.`,"ok")}function st(){if(!v)return;const e=c.items.findIndex(n=>n.id===v);if(e<0){k();return}const[t]=c.items.splice(e,1);S(),k(),d(),nt(t,e),l(`Removed ${t.name}.`,"ok")}function ct(e){e.preventDefault();const t=fe.value.trim(),n=xe.value.trim(),a=J.value.trim(),o=b.value,s=H.value.trim();let r=o;if(o==="__custom__"&&(r=s),!t||!n||!a||!r){l("Please complete all fields.","error");return}if(w(n)===null||w(a)===null){l("Quantity and low level must be numbers.","error");return}if(c.items.some(i=>i.name.toLowerCase()===t.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){l("That item already exists in this category.","error");return}c.items.push({id:j(),name:t,quantity:n,lowLevel:a,category:r}),!C.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),S(),d(),ge.reset(),J.value=ye,b.value=r,te(),l(`Added ${t}.`,"ok")}function it(){h.addEventListener("input",()=>{I=h.value,Z(),U()}),h.addEventListener("keydown",e=>{if(e.key==="Escape"){if(I.trim()){M();return}A(!1)}}),z.addEventListener("click",()=>{if(T){M(),A(!1);return}A(!0,{focus:!0})}),Pe.addEventListener("click",()=>{M(),h.focus()}),Je.addEventListener("click",()=>{M(),A(!1),Be.scrollIntoView({behavior:"smooth",block:"start"}),window.setTimeout(()=>{fe.focus()},200)}),ve.addEventListener("click",()=>{ee()}),b.addEventListener("change",te),ge.addEventListener("submit",ct),E.addEventListener("change",ne),Re.addEventListener("click",st),Ue.addEventListener("submit",rt),$e.addEventListener("click",k),ze.addEventListener("click",ot),y.addEventListener("cancel",()=>{v=null}),y.addEventListener("click",e=>{e.target===y&&k()})}function d(){be(),je(),te(),ne(),Z(),U()}J.value=ye;it();d();l("Ready.");et();
