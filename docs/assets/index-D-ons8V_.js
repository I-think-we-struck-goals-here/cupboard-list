(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const me="cupboard-app-state-v1",ae="/api/cupboard-state",Pe="https://cupboard-list-site.vercel.app/api/cupboard-state",Ge=450,Ne=7e3,Oe=[{name:"Arribato rice",quantity:"1.25",category:"Grains & Pasta"},{name:"Microwave rice",quantity:"2",category:"Grains & Pasta"},{name:"Couscous",quantity:"2",category:"Grains & Pasta"},{name:"Penne Pasta",quantity:"1",category:"Grains & Pasta"},{name:"Rigatoni",quantity:"0.5",category:"Other"},{name:"Medium egg noodles",quantity:"0.5",category:"Grains & Pasta"},{name:"Risotto truffle kit",quantity:"1",category:"Grains & Pasta"},{name:"Miso paste",quantity:"1",category:"Spices & Seasonings"},{name:"Capsicana hot honey",quantity:"1",category:"Sauces & Condiments"},{name:"Garlic seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"BBQ seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"Lentil vertes",quantity:"1",category:"Legumes & Flours"},{name:"Red lentils",quantity:"1",category:"Legumes & Flours"},{name:"Gram flour",quantity:"1",category:"Legumes & Flours"},{name:"Hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Sweet hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Texas BBQ sauce",quantity:"1.25",category:"Sauces & Condiments"},{name:"Korean hot sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Caramel sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Kewpie",quantity:"1",category:"Sauces & Condiments"},{name:"Peanut butter",quantity:"2",category:"Canned Goods"},{name:"Chilli paste",quantity:"1",category:"Sauces & Condiments"},{name:"Mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Grainy mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Chicken korma paste",quantity:"1",category:"Sauces & Condiments"},{name:"Cuppa soup chicken",quantity:"2",category:"Canned Goods"},{name:"Bread crumbs",quantity:"1",category:"Canned Goods"},{name:"Chickpeas",quantity:"1",category:"Legumes & Flours"},{name:"Red cabbage jar",quantity:"1",category:"Canned Goods"},{name:"Gherkins",quantity:"1",category:"Canned Goods"},{name:"Black beans",quantity:"4",category:"Canned Goods"},{name:"Chopped tomatoes",quantity:"1",category:"Canned Goods"},{name:"Coconut cream",quantity:"2",category:"Canned Goods"},{name:"Peach slices",quantity:"1",category:"Canned Goods"},{name:"Tuna tin",quantity:"1",category:"Canned Goods"},{name:"Baked beans",quantity:"1",category:"Canned Goods"},{name:"Chicken gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Vegan gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Chicken stock",quantity:"1",category:"Stock & Gravy"},{name:"Vegetable stock",quantity:"1",category:"Stock & Gravy"},{name:"Beef stock",quantity:"1",category:"Stock & Gravy"}],ye="1",ge="0",S=["Canned Goods","Grains & Pasta","Legumes & Flours","Sauces & Condiments","Spices & Seasonings","Stock & Gravy","Other"],p=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),re=document.querySelector("#filter-bar"),se=document.querySelector("#search-panel"),H=document.querySelector("#search-toggle-btn"),Me=document.querySelector("#clear-search-btn"),R=document.querySelector("#items-body"),Be=document.querySelector("#row-template"),Ue=document.querySelector("#add-section"),fe=document.querySelector("#new-item-form"),ce=document.querySelector("#form-message"),pe=document.querySelector("#new-name"),De=document.querySelector("#new-quantity"),z=document.querySelector("#new-low-level"),b=document.querySelector("#new-category-select"),xe=document.querySelector("#new-custom-category-wrap"),J=document.querySelector("#new-custom-category"),y=document.querySelector("#edit-dialog"),Fe=document.querySelector("#edit-item-form"),Ce=document.querySelector("#edit-name"),Se=document.querySelector("#edit-low-level"),E=document.querySelector("#edit-category-select"),Re=document.querySelector("#edit-custom-category-wrap"),B=document.querySelector("#edit-custom-category"),$e=document.querySelector("#delete-item-button"),Qe=document.querySelector("#cancel-edit"),ie=document.querySelector("#edit-message"),ve=document.querySelector("#undo-toast"),He=document.querySelector("#undo-toast-message"),ze=document.querySelector("#undo-delete-button"),q=document.querySelector("#search-input"),Je=document.querySelector("#top-add-button"),$=document.querySelector("#cloud-status-badge"),we=document.querySelector("#cloud-sync-now-button");let c=je(),v=null,I="",_=!1,g="all",U=null,O=null,T=null,L=!1,Q=!1,P="",A=null,he="",w=!1;function We(){const e=typeof globalThis.CUPBOARD_CLOUD_API_URL=="string"?globalThis.CUPBOARD_CLOUD_API_URL.trim():"";return e||(typeof window>"u"?ae:window.location.hostname.toLowerCase().endsWith(".github.io")?Pe:ae)}const Ke=We();function j(){return globalThis.crypto?.randomUUID?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function h(e){if(e==null)return null;const t=String(e).trim().replace(",",".");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function ue(e){return Number(e.toFixed(3)).toString()}function le(e){return String(e??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function qe(e){const t=h(e.quantity),n=h(e.lowLevel);return t===null||n===null?!1:t<=n}function Y(){return Oe.map(e=>({id:j(),name:e.name,quantity:e.quantity,lowLevel:ye,category:e.category}))}function Ve(e){const t=new Set(S);for(const n of e)t.add(n.category);return[...t].sort((n,a)=>n.localeCompare(a))}function X(e,t){const n=Array.isArray(e?.items)?e.items.filter(o=>o&&o.name&&o.category).map(o=>({id:o.id||j(),name:String(o.name).trim(),quantity:String(o.quantity??""),lowLevel:String(o.lowLevel??ye),category:String(o.category).trim()})):t,a=Array.isArray(e?.customCategories)?e.customCategories.map(o=>String(o).trim()).filter(Boolean):[];return{items:n,customCategories:a}}function W(e){const t=e.items.map(a=>({id:String(a.id),name:String(a.name),quantity:String(a.quantity),lowLevel:String(a.lowLevel),category:String(a.category)})).sort((a,o)=>{const s=p.compare(a.id,o.id);if(s!==0)return s;const r=p.compare(a.name,o.name);return r!==0?r:p.compare(a.category,o.category)}),n=[...e.customCategories].sort((a,o)=>p.compare(a,o));return JSON.stringify({items:t,customCategories:n})}function je(){const e=Y(),t=Ve(e);try{const n=localStorage.getItem(me);if(!n)return{items:e,customCategories:t.filter(o=>!S.includes(o))};const a=JSON.parse(n);return X(a,e)}catch{return{items:e,customCategories:t.filter(n=>!S.includes(n))}}}function Le(){localStorage.setItem(me,JSON.stringify(c))}function C(){Le(),ke()}function be(){const e=new Set([...S,...c.customCategories]);for(const t of c.items)e.add(t.category);return[...e].sort((t,n)=>t.localeCompare(n))}function Ye(){const e=le(I).split(/\s+/).filter(Boolean);return c.items.filter(t=>{const n=g==="all"||g==="low"&&qe(t)||t.category===g;if(e.length===0)return n;const a=le(`${t.name} ${t.category}`);return e.every(o=>a.includes(o))})}function Xe(){const e=new Map;for(const n of Ye()){const a=n.category;e.has(a)||e.set(a,[]),e.get(a).push(n)}return[...e.keys()].sort((n,a)=>p.compare(n,a)).map(n=>{const a=e.get(n).slice().sort((o,s)=>{const r=p.compare(o.name.trim(),s.name.trim());return r!==0?r:p.compare(o.id,s.id)});return{category:n,items:a}})}function de(e,t){const n=be();e.innerHTML="";for(const o of n){const s=document.createElement("option");s.value=o,s.textContent=o,e.append(s)}const a=document.createElement("option");a.value="__custom__",a.textContent="+ Create new category",e.append(a),t&&[...e.options].some(o=>o.value===t)&&(e.value=t)}function Ee(){de(b,b.value),de(E,E.value)}function Ze(){const e=[{value:"all",label:"All"},{value:"low",label:"Low"},...be().map(t=>({value:t,label:t}))];e.some(t=>t.value===g)||(g="all"),re.innerHTML="";for(const t of e){const n=document.createElement("button");n.type="button",n.className=`filter-chip${g===t.value?" active":""}`,n.setAttribute("role","radio"),n.setAttribute("aria-checked",g===t.value?"true":"false"),n.dataset.filter=t.value;const a=document.createElement("span");a.textContent=t.label,n.append(a),n.addEventListener("click",()=>{g=t.value,d()}),re.append(n)}}function Z(){const e=Xe();if(R.innerHTML="",e.length===0){const t=document.createElement("p");t.className="empty-state",t.textContent=I?"No items match your search.":"No items yet. Add your first cupboard item below.",R.append(t);return}for(const t of e){const n=document.createElement("section");n.className="category-section";const a=document.createElement("div");a.className="category-header";const o=document.createElement("span");o.textContent=t.category,a.append(o);const s=document.createElement("div");s.className="items-list",s.setAttribute("role","list");for(const r of t.items){const u=Be.content.firstElementChild.cloneNode(!0),i=u.querySelector('[data-field="name"]'),f=u.querySelector('[data-field="quantity"]'),_e=u.querySelector('[data-action="decrease"]'),Te=u.querySelector('[data-action="increase"]'),Ae=u.querySelector('[data-action="edit"]');i.textContent=r.name,f.value=r.quantity,u.classList.toggle("low",qe(r)),f.addEventListener("change",()=>{r.quantity=f.value.trim(),C(),d()}),_e.addEventListener("click",()=>{const oe=h(r.quantity)??0,F=Math.max(0,oe-1);r.quantity=ue(F),C(),d()}),Te.addEventListener("click",()=>{const F=(h(r.quantity)??0)+1;r.quantity=ue(F),C(),d()}),Ae.addEventListener("click",()=>{ct(r.id)}),s.append(u)}n.append(a,s),R.append(n)}}function l(e,t="ok"){ce.textContent=e,ce.dataset.tone=t}function m(e,t){$.classList.remove("syncing","synced","error"),e&&$.classList.add(e),$.textContent=t}function D(){we.disabled=L,L?m("syncing","Syncing..."):w?m("synced","Shared cloud"):P?m("error","Cloud error"):m("","Local only")}function et(){T!==null&&(window.clearTimeout(T),T=null)}function tt(){A!==null&&(window.clearInterval(A),A=null)}async function Ie(e,t){const n={method:e,headers:{"content-type":"application/json"}};t!==void 0&&(n.body=JSON.stringify(t));let a;try{a=await fetch(Ke,n)}catch{throw new Error("Could not reach cloud API.")}let o=null;try{o=await a.json()}catch{o=null}if(!a.ok){const s=o?.error||`Cloud API error (${a.status}).`;throw new Error(s)}return o??{}}async function ee(){if(L){Q=!0;return}L=!0,D();try{const e=JSON.parse(JSON.stringify(c)),n=(await Ie("PUT",{data:e}))?.data??e,a=Y(),o=X(n,a);he=W(o),w=!0,P="",m("synced","Shared cloud")}catch(e){w=!1,P=e instanceof Error?e.message:"Unknown cloud sync error",m("error","Cloud error")}finally{L=!1,D(),Q&&(Q=!1,ke())}}function ke(){et(),T=window.setTimeout(()=>{T=null,ee()},Ge)}async function K(e={}){const t=!!e.seedIfMissing;L||m("syncing","Syncing...");try{const a=(await Ie("GET"))?.data??null;if(w=!0,!a){t&&await ee();return}const o=Y(),s=X(a,o),r=W(s),u=W(c);he=r,P="",r!==u&&(c=s,Le(),d(),l("Updated from shared cloud.","ok")),m("synced","Shared cloud")}catch(n){w=!1,P=n instanceof Error?n.message:"Unknown error",m("error","Cloud error")}finally{D()}}function nt(){A===null&&(A=window.setInterval(()=>{K()},Ne))}async function ot(){D(),await K({seedIfMissing:!0}),w&&nt(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&K()}),window.addEventListener("beforeunload",tt),l(w?"Ready. Shared cloud sync enabled.":"Ready. Local-only mode.","ok")}function at(){O!==null&&(window.clearTimeout(O),O=null)}function V(e=!0){at(),ve.classList.remove("open"),e&&(U=null)}function rt(e,t){V(!1),U={item:e,index:t},He.textContent=`Removed ${e.name}.`,ve.classList.add("open"),O=window.setTimeout(()=>{V(!0)},3e3)}function st(){if(!U)return;const{item:e,index:t}=U,n=Math.max(0,Math.min(t,c.items.length));c.items.splice(n,0,e),!S.includes(e.category)&&!c.customCategories.includes(e.category)&&(c.customCategories.push(e.category),c.customCategories.sort((a,o)=>a.localeCompare(o))),C(),V(!0),d(),l(`Restored ${e.name}.`,"ok")}function x(){const e=I.trim().length>0;se.classList.toggle("open",_),se.classList.toggle("has-query",e),H.classList.toggle("active",_||e),H.setAttribute("aria-expanded",_?"true":"false")}function G(e,t={}){_=e,x(),e&&t.focus&&window.setTimeout(()=>{q.focus()},120)}function N(){I="",q.value="",Z(),x()}function te(){const e=b.value==="__custom__";xe.classList.toggle("hidden",!e),J.required=e,e&&J.focus()}function M(e,t="ok"){ie.textContent=e,ie.dataset.tone=t}function ne(){const e=E.value==="__custom__";Re.classList.toggle("hidden",!e),B.required=e,e||(B.value="")}function ct(e){const t=c.items.find(n=>n.id===e);t&&(v=e,Ee(),Ce.value=t.name,Se.value=t.lowLevel,E.value=t.category,B.value="",ne(),M("Update details and save."),typeof y.showModal=="function"?y.showModal():y.setAttribute("open",""))}function k(){v=null,typeof y.close=="function"?y.close():y.removeAttribute("open")}function it(e){if(e.preventDefault(),!v)return;const t=c.items.find(i=>i.id===v);if(!t){k();return}const n=Ce.value.trim(),a=Se.value.trim(),o=E.value,s=B.value.trim(),r=o==="__custom__"?s:o;if(!n||!a||!r){M("Please complete all fields.","error");return}if(h(a)===null){M("Running low level must be a number.","error");return}if(c.items.some(i=>i.id!==t.id&&i.name.toLowerCase()===n.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){M("That item already exists in this category.","error");return}t.name=n,t.lowLevel=a,t.category=r,!S.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),C(),k(),d(),l(`Updated ${n}.`,"ok")}function ut(){if(!v)return;const e=c.items.findIndex(n=>n.id===v);if(e<0){k();return}const[t]=c.items.splice(e,1);C(),k(),d(),rt(t,e),l(`Removed ${t.name}.`,"ok")}function lt(e){e.preventDefault();const t=pe.value.trim(),n=De.value.trim(),a=z.value.trim(),o=b.value,s=J.value.trim();let r=o;if(o==="__custom__"&&(r=s),!t||!n||!a||!r){l("Please complete all fields.","error");return}if(h(n)===null||h(a)===null){l("Quantity and low level must be numbers.","error");return}if(c.items.some(i=>i.name.toLowerCase()===t.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){l("That item already exists in this category.","error");return}c.items.push({id:j(),name:t,quantity:n,lowLevel:a,category:r}),!S.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),C(),d(),fe.reset(),z.value=ge,b.value=r,te(),l(`Added ${t}.`,"ok")}function dt(){q.addEventListener("input",()=>{I=q.value,Z(),x()}),q.addEventListener("keydown",e=>{if(e.key==="Escape"){if(I.trim()){N();return}G(!1)}}),H.addEventListener("click",()=>{if(_){N(),G(!1);return}G(!0,{focus:!0})}),Me.addEventListener("click",()=>{N(),q.focus()}),Je.addEventListener("click",()=>{N(),G(!1),Ue.scrollIntoView({behavior:"smooth",block:"start"}),window.setTimeout(()=>{pe.focus()},200)}),we.addEventListener("click",()=>{ee()}),b.addEventListener("change",te),fe.addEventListener("submit",lt),E.addEventListener("change",ne),$e.addEventListener("click",ut),Fe.addEventListener("submit",it),Qe.addEventListener("click",k),ze.addEventListener("click",st),y.addEventListener("cancel",()=>{v=null}),y.addEventListener("click",e=>{e.target===y&&k()})}function d(){Ee(),Ze(),te(),ne(),Z(),x()}z.value=ge;dt();d();l("Ready.");ot();
