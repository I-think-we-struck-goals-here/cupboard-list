(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const ye="cupboard-app-state-v1",R="/api/cupboard-state",$="https://cupboard-list-site.vercel.app/api/cupboard-state",Ge=450,Ne=7e3,Oe=[{name:"Arribato rice",quantity:"1.25",category:"Grains & Pasta"},{name:"Microwave rice",quantity:"2",category:"Grains & Pasta"},{name:"Couscous",quantity:"2",category:"Grains & Pasta"},{name:"Penne Pasta",quantity:"1",category:"Grains & Pasta"},{name:"Rigatoni",quantity:"0.5",category:"Other"},{name:"Medium egg noodles",quantity:"0.5",category:"Grains & Pasta"},{name:"Risotto truffle kit",quantity:"1",category:"Grains & Pasta"},{name:"Miso paste",quantity:"1",category:"Spices & Seasonings"},{name:"Capsicana hot honey",quantity:"1",category:"Sauces & Condiments"},{name:"Garlic seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"BBQ seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"Lentil vertes",quantity:"1",category:"Legumes & Flours"},{name:"Red lentils",quantity:"1",category:"Legumes & Flours"},{name:"Gram flour",quantity:"1",category:"Legumes & Flours"},{name:"Hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Sweet hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Texas BBQ sauce",quantity:"1.25",category:"Sauces & Condiments"},{name:"Korean hot sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Caramel sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Kewpie",quantity:"1",category:"Sauces & Condiments"},{name:"Peanut butter",quantity:"2",category:"Canned Goods"},{name:"Chilli paste",quantity:"1",category:"Sauces & Condiments"},{name:"Mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Grainy mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Chicken korma paste",quantity:"1",category:"Sauces & Condiments"},{name:"Cuppa soup chicken",quantity:"2",category:"Canned Goods"},{name:"Bread crumbs",quantity:"1",category:"Canned Goods"},{name:"Chickpeas",quantity:"1",category:"Legumes & Flours"},{name:"Red cabbage jar",quantity:"1",category:"Canned Goods"},{name:"Gherkins",quantity:"1",category:"Canned Goods"},{name:"Black beans",quantity:"4",category:"Canned Goods"},{name:"Chopped tomatoes",quantity:"1",category:"Canned Goods"},{name:"Coconut cream",quantity:"2",category:"Canned Goods"},{name:"Peach slices",quantity:"1",category:"Canned Goods"},{name:"Tuna tin",quantity:"1",category:"Canned Goods"},{name:"Baked beans",quantity:"1",category:"Canned Goods"},{name:"Chicken gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Vegan gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Chicken stock",quantity:"1",category:"Stock & Gravy"},{name:"Vegetable stock",quantity:"1",category:"Stock & Gravy"},{name:"Beef stock",quantity:"1",category:"Stock & Gravy"}],ge="1",fe="0",S=["Canned Goods","Grains & Pasta","Legumes & Flours","Sauces & Condiments","Spices & Seasonings","Stock & Gravy","Other"],p=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),se=document.querySelector("#filter-bar"),ce=document.querySelector("#search-panel"),J=document.querySelector("#search-toggle-btn"),Me=document.querySelector("#clear-search-btn"),Q=document.querySelector("#items-body"),Be=document.querySelector("#row-template"),Ue=document.querySelector("#add-section"),pe=document.querySelector("#new-item-form"),ie=document.querySelector("#form-message"),Ce=document.querySelector("#new-name"),De=document.querySelector("#new-quantity"),W=document.querySelector("#new-low-level"),L=document.querySelector("#new-category-select"),xe=document.querySelector("#new-custom-category-wrap"),K=document.querySelector("#new-custom-category"),y=document.querySelector("#edit-dialog"),Fe=document.querySelector("#edit-item-form"),Se=document.querySelector("#edit-name"),ve=document.querySelector("#edit-low-level"),b=document.querySelector("#edit-category-select"),Re=document.querySelector("#edit-custom-category-wrap"),B=document.querySelector("#edit-custom-category"),$e=document.querySelector("#delete-item-button"),Qe=document.querySelector("#cancel-edit"),ue=document.querySelector("#edit-message"),we=document.querySelector("#undo-toast"),He=document.querySelector("#undo-toast-message"),ze=document.querySelector("#undo-delete-button"),h=document.querySelector("#search-input"),Je=document.querySelector("#top-add-button"),H=document.querySelector("#cloud-status-badge"),he=document.querySelector("#cloud-sync-now-button");let c=je(),v=null,E="",_=!1,g="all",U=null,O=null,T=null,q=!1,z=!1,P="",A=null,qe="",I=!1;function We(){const e=typeof globalThis.CUPBOARD_CLOUD_API_URL=="string"?globalThis.CUPBOARD_CLOUD_API_URL.trim():"";if(e)return[e];if(typeof window>"u")return[R,$];const t=window.location.hostname.toLowerCase(),n=[];return t.endsWith(".github.io")?n.push($,R):n.push(R,$),[...new Set(n)]}const Ke=We();function X(){return globalThis.crypto?.randomUUID?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function w(e){if(e==null)return null;const t=String(e).trim().replace(",",".");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function le(e){return Number(e.toFixed(3)).toString()}function de(e){return String(e??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function Le(e){const t=w(e.quantity),n=w(e.lowLevel);return t===null||n===null?!1:t<=n}function Z(){return Oe.map(e=>({id:X(),name:e.name,quantity:e.quantity,lowLevel:ge,category:e.category}))}function Ve(e){const t=new Set(S);for(const n of e)t.add(n.category);return[...t].sort((n,o)=>n.localeCompare(o))}function ee(e,t){const n=Array.isArray(e?.items)?e.items.filter(a=>a&&a.name&&a.category).map(a=>({id:a.id||X(),name:String(a.name).trim(),quantity:String(a.quantity??""),lowLevel:String(a.lowLevel??ge),category:String(a.category).trim()})):t,o=Array.isArray(e?.customCategories)?e.customCategories.map(a=>String(a).trim()).filter(Boolean):[];return{items:n,customCategories:o}}function V(e){const t=e.items.map(o=>({id:String(o.id),name:String(o.name),quantity:String(o.quantity),lowLevel:String(o.lowLevel),category:String(o.category)})).sort((o,a)=>{const s=p.compare(o.id,a.id);if(s!==0)return s;const r=p.compare(o.name,a.name);return r!==0?r:p.compare(o.category,a.category)}),n=[...e.customCategories].sort((o,a)=>p.compare(o,a));return JSON.stringify({items:t,customCategories:n})}function je(){const e=Z(),t=Ve(e);try{const n=localStorage.getItem(ye);if(!n)return{items:e,customCategories:t.filter(a=>!S.includes(a))};const o=JSON.parse(n);return ee(o,e)}catch{return{items:e,customCategories:t.filter(n=>!S.includes(n))}}}function be(){localStorage.setItem(ye,JSON.stringify(c))}function C(){be(),_e()}function Ee(){const e=new Set([...S,...c.customCategories]);for(const t of c.items)e.add(t.category);return[...e].sort((t,n)=>t.localeCompare(n))}function Ye(){const e=de(E).split(/\s+/).filter(Boolean);return c.items.filter(t=>{const n=g==="all"||g==="low"&&Le(t)||t.category===g;if(e.length===0)return n;const o=de(`${t.name} ${t.category}`);return e.every(a=>o.includes(a))})}function Xe(){const e=new Map;for(const n of Ye()){const o=n.category;e.has(o)||e.set(o,[]),e.get(o).push(n)}return[...e.keys()].sort((n,o)=>p.compare(n,o)).map(n=>{const o=e.get(n).slice().sort((a,s)=>{const r=p.compare(a.name.trim(),s.name.trim());return r!==0?r:p.compare(a.id,s.id)});return{category:n,items:o}})}function me(e,t){const n=Ee();e.innerHTML="";for(const a of n){const s=document.createElement("option");s.value=a,s.textContent=a,e.append(s)}const o=document.createElement("option");o.value="__custom__",o.textContent="+ Create new category",e.append(o),t&&[...e.options].some(a=>a.value===t)&&(e.value=t)}function Ie(){me(L,L.value),me(b,b.value)}function Ze(){const e=[{value:"all",label:"All"},{value:"low",label:"Low"},...Ee().map(t=>({value:t,label:t}))];e.some(t=>t.value===g)||(g="all"),se.innerHTML="";for(const t of e){const n=document.createElement("button");n.type="button",n.className=`filter-chip${g===t.value?" active":""}`,n.setAttribute("role","radio"),n.setAttribute("aria-checked",g===t.value?"true":"false"),n.dataset.filter=t.value;const o=document.createElement("span");o.textContent=t.label,n.append(o),n.addEventListener("click",()=>{g=t.value,d()}),se.append(n)}}function te(){const e=Xe();if(Q.innerHTML="",e.length===0){const t=document.createElement("p");t.className="empty-state",t.textContent=E?"No items match your search.":"No items yet. Add your first cupboard item below.",Q.append(t);return}for(const t of e){const n=document.createElement("section");n.className="category-section";const o=document.createElement("div");o.className="category-header";const a=document.createElement("span");a.textContent=t.category,o.append(a);const s=document.createElement("div");s.className="items-list",s.setAttribute("role","list");for(const r of t.items){const u=Be.content.firstElementChild.cloneNode(!0),i=u.querySelector('[data-field="name"]'),f=u.querySelector('[data-field="quantity"]'),Te=u.querySelector('[data-action="decrease"]'),Ae=u.querySelector('[data-action="increase"]'),Pe=u.querySelector('[data-action="edit"]');i.textContent=r.name,f.value=r.quantity,u.classList.toggle("low",Le(r)),f.addEventListener("change",()=>{r.quantity=f.value.trim(),C(),d()}),Te.addEventListener("click",()=>{const re=w(r.quantity)??0,F=Math.max(0,re-1);r.quantity=le(F),C(),d()}),Ae.addEventListener("click",()=>{const F=(w(r.quantity)??0)+1;r.quantity=le(F),C(),d()}),Pe.addEventListener("click",()=>{ct(r.id)}),s.append(u)}n.append(o,s),Q.append(n)}}function l(e,t="ok"){ie.textContent=e,ie.dataset.tone=t}function m(e,t){H.classList.remove("syncing","synced","error"),e&&H.classList.add(e),H.textContent=t}function D(){he.disabled=q,q?m("syncing","Syncing..."):I?m("synced","Shared cloud"):P?m("error","Cloud error"):m("","Local only")}function et(){T!==null&&(window.clearTimeout(T),T=null)}function tt(){A!==null&&(window.clearInterval(A),A=null)}async function ke(e,t){const n={method:e,headers:{"content-type":"application/json"}};t!==void 0&&(n.body=JSON.stringify(t));let o=null;for(const a of Ke){let s;try{s=await fetch(a,n)}catch{o=new Error("Could not reach cloud API.");continue}let r=null;try{r=await s.json()}catch{r=null}if(s.ok)return r??{};const u=r?.error||`Cloud API error (${s.status}).`;if(o=new Error(u),!(s.status===404||s.status===405))throw o}throw o||new Error("Could not reach cloud API.")}async function ne(){if(q){z=!0;return}q=!0,D();try{const e=JSON.parse(JSON.stringify(c)),n=(await ke("PUT",{data:e}))?.data??e,o=Z(),a=ee(n,o);qe=V(a),I=!0,P="",m("synced","Shared cloud")}catch(e){I=!1,P=e instanceof Error?e.message:"Unknown cloud sync error",m("error","Cloud error")}finally{q=!1,D(),z&&(z=!1,_e())}}function _e(){et(),T=window.setTimeout(()=>{T=null,ne()},Ge)}async function j(e={}){const t=!!e.seedIfMissing;q||m("syncing","Syncing...");try{const o=(await ke("GET"))?.data??null;if(I=!0,!o){t&&await ne();return}const a=Z(),s=ee(o,a),r=V(s),u=V(c);qe=r,P="",r!==u&&(c=s,be(),d(),l("Updated from shared cloud.","ok")),m("synced","Shared cloud")}catch(n){I=!1,P=n instanceof Error?n.message:"Unknown error",m("error","Cloud error")}finally{D()}}function nt(){A===null&&(A=window.setInterval(()=>{j()},Ne))}async function ot(){D(),await j({seedIfMissing:!0}),nt(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&j()}),window.addEventListener("beforeunload",tt),l(I?"Ready. Shared cloud sync enabled.":"Ready. Local-only mode.","ok")}function at(){O!==null&&(window.clearTimeout(O),O=null)}function Y(e=!0){at(),we.classList.remove("open"),e&&(U=null)}function rt(e,t){Y(!1),U={item:e,index:t},He.textContent=`Removed ${e.name}.`,we.classList.add("open"),O=window.setTimeout(()=>{Y(!0)},3e3)}function st(){if(!U)return;const{item:e,index:t}=U,n=Math.max(0,Math.min(t,c.items.length));c.items.splice(n,0,e),!S.includes(e.category)&&!c.customCategories.includes(e.category)&&(c.customCategories.push(e.category),c.customCategories.sort((o,a)=>o.localeCompare(a))),C(),Y(!0),d(),l(`Restored ${e.name}.`,"ok")}function x(){const e=E.trim().length>0;ce.classList.toggle("open",_),ce.classList.toggle("has-query",e),J.classList.toggle("active",_||e),J.setAttribute("aria-expanded",_?"true":"false")}function G(e,t={}){_=e,x(),e&&t.focus&&window.setTimeout(()=>{h.focus()},120)}function N(){E="",h.value="",te(),x()}function oe(){const e=L.value==="__custom__";xe.classList.toggle("hidden",!e),K.required=e,e&&K.focus()}function M(e,t="ok"){ue.textContent=e,ue.dataset.tone=t}function ae(){const e=b.value==="__custom__";Re.classList.toggle("hidden",!e),B.required=e,e||(B.value="")}function ct(e){const t=c.items.find(n=>n.id===e);t&&(v=e,Ie(),Se.value=t.name,ve.value=t.lowLevel,b.value=t.category,B.value="",ae(),M("Update details and save."),typeof y.showModal=="function"?y.showModal():y.setAttribute("open",""))}function k(){v=null,typeof y.close=="function"?y.close():y.removeAttribute("open")}function it(e){if(e.preventDefault(),!v)return;const t=c.items.find(i=>i.id===v);if(!t){k();return}const n=Se.value.trim(),o=ve.value.trim(),a=b.value,s=B.value.trim(),r=a==="__custom__"?s:a;if(!n||!o||!r){M("Please complete all fields.","error");return}if(w(o)===null){M("Running low level must be a number.","error");return}if(c.items.some(i=>i.id!==t.id&&i.name.toLowerCase()===n.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){M("That item already exists in this category.","error");return}t.name=n,t.lowLevel=o,t.category=r,!S.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),C(),k(),d(),l(`Updated ${n}.`,"ok")}function ut(){if(!v)return;const e=c.items.findIndex(n=>n.id===v);if(e<0){k();return}const[t]=c.items.splice(e,1);C(),k(),d(),rt(t,e),l(`Removed ${t.name}.`,"ok")}function lt(e){e.preventDefault();const t=Ce.value.trim(),n=De.value.trim(),o=W.value.trim(),a=L.value,s=K.value.trim();let r=a;if(a==="__custom__"&&(r=s),!t||!n||!o||!r){l("Please complete all fields.","error");return}if(w(n)===null||w(o)===null){l("Quantity and low level must be numbers.","error");return}if(c.items.some(i=>i.name.toLowerCase()===t.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){l("That item already exists in this category.","error");return}c.items.push({id:X(),name:t,quantity:n,lowLevel:o,category:r}),!S.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,f)=>i.localeCompare(f))),C(),d(),pe.reset(),W.value=fe,L.value=r,oe(),l(`Added ${t}.`,"ok")}function dt(){h.addEventListener("input",()=>{E=h.value,te(),x()}),h.addEventListener("keydown",e=>{if(e.key==="Escape"){if(E.trim()){N();return}G(!1)}}),J.addEventListener("click",()=>{if(_){N(),G(!1);return}G(!0,{focus:!0})}),Me.addEventListener("click",()=>{N(),h.focus()}),Je.addEventListener("click",()=>{N(),G(!1),Ue.scrollIntoView({behavior:"smooth",block:"start"}),window.setTimeout(()=>{Ce.focus()},200)}),he.addEventListener("click",()=>{ne()}),L.addEventListener("change",oe),pe.addEventListener("submit",lt),b.addEventListener("change",ae),$e.addEventListener("click",ut),Fe.addEventListener("submit",it),Qe.addEventListener("click",k),ze.addEventListener("click",st),y.addEventListener("cancel",()=>{v=null}),y.addEventListener("click",e=>{e.target===y&&k()})}function d(){Ie(),Ze(),oe(),ae(),te(),x()}W.value=fe;dt();d();l("Ready.");ot();
