(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ge="cupboard-app-state-v1",Q="/api/cupboard-state",H="https://cupboard-list-site.vercel.app/api/cupboard-state",Ne=450,Oe=7e3,Be=[{name:"Arribato rice",quantity:"1.25",category:"Grains & Pasta"},{name:"Microwave rice",quantity:"2",category:"Grains & Pasta"},{name:"Couscous",quantity:"2",category:"Grains & Pasta"},{name:"Penne Pasta",quantity:"1",category:"Grains & Pasta"},{name:"Rigatoni",quantity:"0.5",category:"Other"},{name:"Medium egg noodles",quantity:"0.5",category:"Grains & Pasta"},{name:"Risotto truffle kit",quantity:"1",category:"Grains & Pasta"},{name:"Miso paste",quantity:"1",category:"Spices & Seasonings"},{name:"Capsicana hot honey",quantity:"1",category:"Sauces & Condiments"},{name:"Garlic seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"BBQ seasoning bag",quantity:"1",category:"Spices & Seasonings"},{name:"Lentil vertes",quantity:"1",category:"Legumes & Flours"},{name:"Red lentils",quantity:"1",category:"Legumes & Flours"},{name:"Gram flour",quantity:"1",category:"Legumes & Flours"},{name:"Hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Sweet hoisin sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Texas BBQ sauce",quantity:"1.25",category:"Sauces & Condiments"},{name:"Korean hot sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Caramel sauce",quantity:"1",category:"Sauces & Condiments"},{name:"Kewpie",quantity:"1",category:"Sauces & Condiments"},{name:"Peanut butter",quantity:"2",category:"Canned Goods"},{name:"Chilli paste",quantity:"1",category:"Sauces & Condiments"},{name:"Mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Grainy mustard",quantity:"1",category:"Sauces & Condiments"},{name:"Chicken korma paste",quantity:"1",category:"Sauces & Condiments"},{name:"Cuppa soup chicken",quantity:"2",category:"Canned Goods"},{name:"Bread crumbs",quantity:"1",category:"Canned Goods"},{name:"Chickpeas",quantity:"1",category:"Legumes & Flours"},{name:"Red cabbage jar",quantity:"1",category:"Canned Goods"},{name:"Gherkins",quantity:"1",category:"Canned Goods"},{name:"Black beans",quantity:"4",category:"Canned Goods"},{name:"Chopped tomatoes",quantity:"1",category:"Canned Goods"},{name:"Coconut cream",quantity:"2",category:"Canned Goods"},{name:"Peach slices",quantity:"1",category:"Canned Goods"},{name:"Tuna tin",quantity:"1",category:"Canned Goods"},{name:"Baked beans",quantity:"1",category:"Canned Goods"},{name:"Chicken gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Vegan gravy granules",quantity:"1",category:"Stock & Gravy"},{name:"Chicken stock",quantity:"1",category:"Stock & Gravy"},{name:"Vegetable stock",quantity:"1",category:"Stock & Gravy"},{name:"Beef stock",quantity:"1",category:"Stock & Gravy"}],fe="1",pe="0",h=["Canned Goods","Grains & Pasta","Legumes & Flours","Sauces & Condiments","Spices & Seasonings","Stock & Gravy","Other"],C=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0}),ce=document.querySelector("#filter-bar"),ie=document.querySelector("#search-panel"),K=document.querySelector("#search-toggle-btn"),Me=document.querySelector("#clear-search-btn"),z=document.querySelector("#items-body"),Ue=document.querySelector("#row-template"),De=document.querySelector("#add-section"),Ce=document.querySelector("#new-item-form"),ue=document.querySelector("#form-message"),Se=document.querySelector("#new-name"),xe=document.querySelector("#new-quantity"),V=document.querySelector("#new-low-level"),b=document.querySelector("#new-category-select"),Fe=document.querySelector("#new-custom-category-wrap"),j=document.querySelector("#new-custom-category"),g=document.querySelector("#edit-dialog"),Re=document.querySelector("#edit-item-form"),ve=document.querySelector("#edit-name"),he=document.querySelector("#edit-low-level"),E=document.querySelector("#edit-category-select"),$e=document.querySelector("#edit-custom-category-wrap"),D=document.querySelector("#edit-custom-category"),Qe=document.querySelector("#delete-item-button"),He=document.querySelector("#cancel-edit"),le=document.querySelector("#edit-message"),we=document.querySelector("#undo-toast"),ze=document.querySelector("#undo-toast-message"),Je=document.querySelector("#undo-delete-button"),L=document.querySelector("#search-input"),We=document.querySelector("#top-add-button"),J=document.querySelector("#cloud-status-badge"),qe=document.querySelector("#cloud-sync-now-button");let c=Ye(),w=null,I="",T=!1,f="all",x=null,M=null,A=null,d=!1,W=!1,G="",P=null,Le="",k=!1,S=!1;function Ke(){const e=typeof globalThis.CUPBOARD_CLOUD_API_URL=="string"?globalThis.CUPBOARD_CLOUD_API_URL.trim():"";if(e)return[e];if(typeof window>"u")return[Q,H];const t=window.location.hostname.toLowerCase(),n=[];return t.endsWith(".github.io")?n.push(H,Q):n.push(Q,H),[...new Set(n)]}const Ve=Ke();function ee(){return globalThis.crypto?.randomUUID?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function q(e){if(e==null)return null;const t=String(e).trim().replace(",",".");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function de(e){return Number(e.toFixed(3)).toString()}function me(e){return String(e??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function be(e){const t=q(e.quantity),n=q(e.lowLevel);return t===null||n===null?!1:t<=n}function te(){return Be.map(e=>({id:ee(),name:e.name,quantity:e.quantity,lowLevel:fe,category:e.category}))}function je(e){const t=new Set(h);for(const n of e)t.add(n.category);return[...t].sort((n,a)=>n.localeCompare(a))}function ne(e,t){const n=Array.isArray(e?.items)?e.items.filter(o=>o&&o.name&&o.category).map(o=>({id:o.id||ee(),name:String(o.name).trim(),quantity:String(o.quantity??""),lowLevel:String(o.lowLevel??fe),category:String(o.category).trim()})):t,a=Array.isArray(e?.customCategories)?e.customCategories.map(o=>String(o).trim()).filter(Boolean):[];return{items:n,customCategories:a}}function Y(e){const t=e.items.map(a=>({id:String(a.id),name:String(a.name),quantity:String(a.quantity),lowLevel:String(a.lowLevel),category:String(a.category)})).sort((a,o)=>{const s=C.compare(a.id,o.id);if(s!==0)return s;const r=C.compare(a.name,o.name);return r!==0?r:C.compare(a.category,o.category)}),n=[...e.customCategories].sort((a,o)=>C.compare(a,o));return JSON.stringify({items:t,customCategories:n})}function Ye(){const e=te(),t=je(e);try{const n=localStorage.getItem(ge);if(!n)return{items:e,customCategories:t.filter(o=>!h.includes(o))};const a=JSON.parse(n);return ne(a,e)}catch{return{items:e,customCategories:t.filter(n=>!h.includes(n))}}}function Ee(){localStorage.setItem(ge,JSON.stringify(c))}function v(){Ee(),S=!0,Te()}function Ie(){const e=new Set([...h,...c.customCategories]);for(const t of c.items)e.add(t.category);return[...e].sort((t,n)=>t.localeCompare(n))}function Xe(){const e=me(I).split(/\s+/).filter(Boolean);return c.items.filter(t=>{const n=f==="all"||f==="low"&&be(t)||t.category===f;if(e.length===0)return n;const a=me(`${t.name} ${t.category}`);return e.every(o=>a.includes(o))})}function Ze(){const e=new Map;for(const n of Xe()){const a=n.category;e.has(a)||e.set(a,[]),e.get(a).push(n)}return[...e.keys()].sort((n,a)=>C.compare(n,a)).map(n=>{const a=e.get(n).slice().sort((o,s)=>{const r=C.compare(o.name.trim(),s.name.trim());return r!==0?r:C.compare(o.id,s.id)});return{category:n,items:a}})}function ye(e,t){const n=Ie();e.innerHTML="";for(const o of n){const s=document.createElement("option");s.value=o,s.textContent=o,e.append(s)}const a=document.createElement("option");a.value="__custom__",a.textContent="+ Create new category",e.append(a),t&&[...e.options].some(o=>o.value===t)&&(e.value=t)}function ke(){ye(b,b.value),ye(E,E.value)}function et(){const e=[{value:"all",label:"All"},{value:"low",label:"Low"},...Ie().map(t=>({value:t,label:t}))];e.some(t=>t.value===f)||(f="all"),ce.innerHTML="";for(const t of e){const n=document.createElement("button");n.type="button",n.className=`filter-chip${f===t.value?" active":""}`,n.setAttribute("role","radio"),n.setAttribute("aria-checked",f===t.value?"true":"false"),n.dataset.filter=t.value;const a=document.createElement("span");a.textContent=t.label,n.append(a),n.addEventListener("click",()=>{f=t.value,m()}),ce.append(n)}}function oe(){const e=Ze();if(z.innerHTML="",e.length===0){const t=document.createElement("p");t.className="empty-state",t.textContent=I?"No items match your search.":"No items yet. Add your first cupboard item below.",z.append(t);return}for(const t of e){const n=document.createElement("section");n.className="category-section";const a=document.createElement("div");a.className="category-header";const o=document.createElement("span");o.textContent=t.category,a.append(o);const s=document.createElement("div");s.className="items-list",s.setAttribute("role","list");for(const r of t.items){const u=Ue.content.firstElementChild.cloneNode(!0),i=u.querySelector('[data-field="name"]'),p=u.querySelector('[data-field="quantity"]'),Ae=u.querySelector('[data-action="decrease"]'),Pe=u.querySelector('[data-action="increase"]'),Ge=u.querySelector('[data-action="edit"]');i.textContent=r.name,p.value=r.quantity,u.classList.toggle("low",be(r)),p.addEventListener("change",()=>{r.quantity=p.value.trim(),v(),m()}),Ae.addEventListener("click",()=>{const se=q(r.quantity)??0,$=Math.max(0,se-1);r.quantity=de($),v(),m()}),Pe.addEventListener("click",()=>{const $=(q(r.quantity)??0)+1;r.quantity=de($),v(),m()}),Ge.addEventListener("click",()=>{it(r.id)}),s.append(u)}n.append(a,s),z.append(n)}}function l(e,t="ok"){ue.textContent=e,ue.dataset.tone=t}function y(e,t){J.classList.remove("syncing","synced","error"),e&&J.classList.add(e),J.textContent=t}function F(){qe.disabled=d,d?y("syncing","Syncing..."):k?y("synced","Shared cloud"):G?y("error","Cloud error"):y("","Local only")}function tt(){A!==null&&(window.clearTimeout(A),A=null)}function nt(){P!==null&&(window.clearInterval(P),P=null)}async function _e(e,t){const n={method:e,headers:{"content-type":"application/json"}};t!==void 0&&(n.body=JSON.stringify(t));let a=null;for(const o of Ve){let s;try{s=await fetch(o,n)}catch{a=new Error("Could not reach cloud API.");continue}let r=null;try{r=await s.json()}catch{r=null}if(s.ok)return r??{};const u=r?.error||`Cloud API error (${s.status}).`;if(a=new Error(u),!(s.status===404||s.status===405))throw a}throw a||new Error("Could not reach cloud API.")}async function N(){if(d){W=!0;return}d=!0,F();try{const e=JSON.parse(JSON.stringify(c)),n=(await _e("PUT",{data:e}))?.data??e,a=te(),o=ne(n,a);Le=Y(o),S=!1,k=!0,G="",y("synced","Shared cloud")}catch(e){k=!1,G=e instanceof Error?e.message:"Unknown cloud sync error",y("error","Cloud error")}finally{d=!1,F(),W&&(W=!1,Te())}}function Te(){tt(),A=window.setTimeout(()=>{A=null,N()},Ne)}async function X(e={}){const t=!!e.seedIfMissing,n=!!e.force;if(!(!n&&(S||d))){d||y("syncing","Syncing...");try{const o=(await _e("GET"))?.data??null;if(k=!0,!n&&(S||d))return;if(!o){t&&await N();return}const s=te(),r=ne(o,s),u=Y(r),i=Y(c);Le=u,G="",S=!1,u!==i&&(c=r,Ee(),m(),l("Updated from shared cloud.","ok")),y("synced","Shared cloud")}catch(a){k=!1,G=a instanceof Error?a.message:"Unknown error",y("error","Cloud error")}finally{F()}}}function ot(){P===null&&(P=window.setInterval(()=>{if(S||d){N();return}X()},Oe))}async function at(){F(),await X({seedIfMissing:!0}),ot(),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){if(S||d){N();return}X()}}),window.addEventListener("beforeunload",nt),l(k?"Ready. Shared cloud sync enabled.":"Ready. Local-only mode.","ok")}function rt(){M!==null&&(window.clearTimeout(M),M=null)}function Z(e=!0){rt(),we.classList.remove("open"),e&&(x=null)}function st(e,t){Z(!1),x={item:e,index:t},ze.textContent=`Removed ${e.name}.`,we.classList.add("open"),M=window.setTimeout(()=>{Z(!0)},3e3)}function ct(){if(!x)return;const{item:e,index:t}=x,n=Math.max(0,Math.min(t,c.items.length));c.items.splice(n,0,e),!h.includes(e.category)&&!c.customCategories.includes(e.category)&&(c.customCategories.push(e.category),c.customCategories.sort((a,o)=>a.localeCompare(o))),v(),Z(!0),m(),l(`Restored ${e.name}.`,"ok")}function R(){const e=I.trim().length>0;ie.classList.toggle("open",T),ie.classList.toggle("has-query",e),K.classList.toggle("active",T||e),K.setAttribute("aria-expanded",T?"true":"false")}function O(e,t={}){T=e,R(),e&&t.focus&&window.setTimeout(()=>{L.focus()},120)}function B(){I="",L.value="",oe(),R()}function ae(){const e=b.value==="__custom__";Fe.classList.toggle("hidden",!e),j.required=e,e&&j.focus()}function U(e,t="ok"){le.textContent=e,le.dataset.tone=t}function re(){const e=E.value==="__custom__";$e.classList.toggle("hidden",!e),D.required=e,e||(D.value="")}function it(e){const t=c.items.find(n=>n.id===e);t&&(w=e,ke(),ve.value=t.name,he.value=t.lowLevel,E.value=t.category,D.value="",re(),U("Update details and save."),typeof g.showModal=="function"?g.showModal():g.setAttribute("open",""))}function _(){w=null,typeof g.close=="function"?g.close():g.removeAttribute("open")}function ut(e){if(e.preventDefault(),!w)return;const t=c.items.find(i=>i.id===w);if(!t){_();return}const n=ve.value.trim(),a=he.value.trim(),o=E.value,s=D.value.trim(),r=o==="__custom__"?s:o;if(!n||!a||!r){U("Please complete all fields.","error");return}if(q(a)===null){U("Running low level must be a number.","error");return}if(c.items.some(i=>i.id!==t.id&&i.name.toLowerCase()===n.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){U("That item already exists in this category.","error");return}t.name=n,t.lowLevel=a,t.category=r,!h.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,p)=>i.localeCompare(p))),v(),_(),m(),l(`Updated ${n}.`,"ok")}function lt(){if(!w)return;const e=c.items.findIndex(n=>n.id===w);if(e<0){_();return}const[t]=c.items.splice(e,1);v(),_(),m(),st(t,e),l(`Removed ${t.name}.`,"ok")}function dt(e){e.preventDefault();const t=Se.value.trim(),n=xe.value.trim(),a=V.value.trim(),o=b.value,s=j.value.trim();let r=o;if(o==="__custom__"&&(r=s),!t||!n||!a||!r){l("Please complete all fields.","error");return}if(q(n)===null||q(a)===null){l("Quantity and low level must be numbers.","error");return}if(c.items.some(i=>i.name.toLowerCase()===t.toLowerCase()&&i.category.toLowerCase()===r.toLowerCase())){l("That item already exists in this category.","error");return}c.items.push({id:ee(),name:t,quantity:n,lowLevel:a,category:r}),!h.includes(r)&&!c.customCategories.includes(r)&&(c.customCategories.push(r),c.customCategories.sort((i,p)=>i.localeCompare(p))),v(),m(),Ce.reset(),V.value=pe,b.value=r,ae(),l(`Added ${t}.`,"ok")}function mt(){L.addEventListener("input",()=>{I=L.value,oe(),R()}),L.addEventListener("keydown",e=>{if(e.key==="Escape"){if(I.trim()){B();return}O(!1)}}),K.addEventListener("click",()=>{if(T){B(),O(!1);return}O(!0,{focus:!0})}),Me.addEventListener("click",()=>{B(),L.focus()}),We.addEventListener("click",()=>{B(),O(!1),De.scrollIntoView({behavior:"smooth",block:"start"}),window.setTimeout(()=>{Se.focus()},200)}),qe.addEventListener("click",()=>{N()}),b.addEventListener("change",ae),Ce.addEventListener("submit",dt),E.addEventListener("change",re),Qe.addEventListener("click",lt),Re.addEventListener("submit",ut),He.addEventListener("click",_),Je.addEventListener("click",ct),g.addEventListener("cancel",()=>{w=null}),g.addEventListener("click",e=>{e.target===g&&_()})}function m(){ke(),et(),ae(),re(),oe(),R()}V.value=pe;mt();m();l("Ready.");at();
